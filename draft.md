
https://github.com/tbfungeek/iOS-Performance-Optimization



http://www.lib4dev.in/info/skyming/iOS-Performance-Optimization/58248014









我们必须依赖 Xcode 环境，并且联机的情况下进行分析工作

连接超时、闪退、卡顿、崩溃、黑白屏、网络劫持、交互性能差、CPU 使用率问题、内存泄露、不良接口

如 CPU 占用率、内存使用情况、FPS、冷启动、热启动时间，网络，耗电量等


CPU 用户使用过程遭遇卡顿    导致手机发热发烫，电量被快速消耗完


https://engineering.fb.com/


开发过程中，主要是通过监控内存使用及泄露，CPU使用率，FPS，启动时间等指标，以及常见的UI的主线程监测，NSAssert断言等，最好能在Debug模式下，实时显示在界面上，针对出现的问题及早解决


内存问题主要包括两个部分，一个是iOS中常见循环引用导致的内存泄露 ，另外就是大量数据加载及使用导致的内存警告。

整个端到端监控的可以在多个维度上做查询端到端成功率、响应时间、访问量的查询，维度包括：返回码、网络、版本、平台、地区、运营商等。


死锁：主线程拿到锁 A，需要获得锁 B，而同时某个子线程拿了锁 B，需要锁 A，这样相互等待就死锁了。

抢锁：主线程需要访问 DB，而此时某个子线程往 DB 插入大量数据。通常抢锁的体验是偶尔卡一阵子，过会就恢复了。

主线程大量 IO：主线程为了方便直接写入大量数据，会导致界面卡顿。

主线程大量计算：算法不合理，导致主线程某个函数占用大量 CPU。

大量的 UI 绘制：复杂的 UI、图文混排等，带来大量的 UI 绘制。

针对这些原因，我们可以怎么定位问题呢？

死锁一般会伴随 crash，可以通过 crash report 来分析。

抢锁不好办，将锁等待时间打出来用处不大，我们还需要知道是谁占了锁。

大量 IO 可以在函数开始结束打点，将占用时间打到日志中。

大量计算同理可以将耗时打到日志中。

大量 UI 绘制一般是必现，还好办；如果是偶现的话，想加日志点都没地方，因为是慢在系统函数里面。



机器环境相关性

可能是特定用户的手机上才有问题，由于种种原因这个手机不能拿来调试；也有可能是特定的时机才会出问题，过后就不能重现了（例如线程抢锁）

大部分不必现，日志无法准确打点

Crash、卡顿、耗时、内存、SQLite、安装包大小、网络性能等。


采集配置  功能和条件采样
功能开关配置  开关功能
上报时机配置  上报数据时间间隔

全局配置  保存数据最大值  单条数据上报大小 指标配置


住县城rUNLOOP 监控 

cpu 使用率监控
FPS监控

@林奇峰(Qa Lin)  @徐颖(Kristy)  
【提测】【iOS观众端】 APM增加OOM检测能力
提测版本：6789
提测单： https://www.tapd.cn/47540949/prong/tasks/view/1147540949001096626


